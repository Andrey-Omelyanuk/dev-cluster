apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: infobiz-dev 
resources:
  - ../base
  - config.yml 
  - config.pub-sub.yml
  - ingress.yml

images:
  - { name: front-react, newTag: dev, newName: repo.edtechworld.pl/edtechworld/infobiz-front }
  - { name: back       , newTag: dev, newName: repo.edtechworld.pl/edtechworld/infobiz-back  }

patches:
  - path: deployment-patches/back.yml
  - path: deployment-patches/beat.yml
  - path: deployment-patches/flower.yml
  - path: deployment-patches/front.yml
  - path: deployment-patches/worker.yml

configMapGenerator:

  - name: pub-sub-config 
    # anyway secrets are hadled by sealed-secrets and we have to restart pods to apply new config
    # so in this case it is not make sense to use suffix hash for configmap
    # keep it simple
    options:
      disableNameSuffixHash: true
    literals:
      - CENTRIFUGO_LOG_LEVEL=debug
      - CENTRIFUGO_ALLOWED_ORIGINS="['*']"

  - name: back-config 
    options:
      disableNameSuffixHash: true
    literals:
      - DEBUG=True
      # - ALLOWED_HOSTS=dev.???.online
      # - CSRF_TRUSTED_ORIGINS=https://???.online
      - ADMINS=
      - MANAGERS=
      - CELERY_BROKER_URL=redis://:@redis:6379/0
      # - DB_HOST=???
      - DB_NAME=infobiz-dev
      - DB_USER=infobiz-dev
      # - S3_ENDPOINT_URL=http://minio:9000
      - S3_BUCKET_NAME=infobiz-dev
